# data-raw/process_internal.R
# Script to process internal datasets for the HOME package.
# This script converts raw coefficient matrices into Base R data frames
# to ensure zero dependencies (no data.table required).

# ==============================================================================
# 1. TIMAEUS COEFFICIENTS (1991)
# ==============================================================================

coef_timaeus <- list(
  Female = data.frame(
    Age = c(10, 15, 20, 25, 30, 35, 40, 45, 50),
    a_n = c(-0.2894, -0.1718, -0.1513, -0.1808, -0.2511, -0.3644, -0.5181, -0.6880, -0.8054),
    b_n = c(0.00125, 0.00222, 0.00372, 0.00586, 0.00885, 0.01287, 0.01795, 0.02342, 0.02721),
    c_n = c(1.2559, 1.1123, 1.0525, 1.0267, 1.0219, 1.0380, 1.0753, 1.1276, 1.1678)
  ),
  Male = data.frame(
    Age = c(10, 15, 20, 25, 30, 35, 40),
    a_n = c(-0.5578, -0.4013, -0.3329, -0.4726, -0.7056, -0.9153, -0.9950),
    b_n = c(0.00040, 0.00576, 0.01031, 0.01559, 0.02076, 0.02493, 0.02635),
    c_n = c(1.47078, 1.56020, 0.66560, 0.21610, 0.19970, 0.34840, 0.42690),
    d_n = c(0.06978, -0.35220, 0.34190, 0.78960, 0.90660, 0.86310, 0.82630)
  )
)

# ==============================================================================
# 2. LUY COEFFICIENTS (2012)
# ==============================================================================
# Structure: Data Frames where columns represent Mean Age at Childbearing (Mn)
# and rows represent the Respondent Age Group.

ages_vec <- c(20, 25, 30, 35, 40, 45, 50, 55, 60)

# --- 2A. FEMALE COEFFICIENTS ---

# WN (Weighting Factors) - Female
df_wn_f <- data.frame(
  Age_Group = ages_vec,
  `22` = c(0.98127470, 0.97652389, 0.96285821, 0.93693363, 0.88937133, 0.81015260, 0.67668398, 0.47865927, 0.25211513),
  `23` = c(0.98652334, 0.97837053, 0.96635250, 0.94209872, 0.89846684, 0.82533808, 0.70104680, 0.50892485, 0.28715073),
  `24` = c(0.98776788, 0.98051467, 0.97025630, 0.94802867, 0.90897573, 0.84591524, 0.73056389, 0.54674209, 0.33847643),
  `25` = c(0.98934193, 0.98321627, 0.97507281, 0.95553151, 0.92257712, 0.87423845, 0.77095572, 0.59995566, 0.41565030),
  `26` = c(0.99117498, 0.98662903, 0.98141808, 0.96546289, 0.94075278, 0.91062231, 0.82928043, 0.68292301, 0.51674307),
  `27` = c(0.99355225, 0.99077520, 0.98867477, 0.97808465, 0.96369544, 0.94806809, 0.89391136, 0.78448385, 0.64962676),
  `28` = c(0.99614331, 0.99511055, 0.99574158, 0.99177736, 0.98706600, 0.98776745, 0.96314516, 0.89954107, 0.83446143),
  `29` = c(0.99783557, 0.99810757, 1.00113196, 1.00543739, 1.01133538, 1.03251201, 1.04269224, 1.04095045, 1.04618128),
  `30` = c(0.99964271, 1.00131646, 1.00704216, 1.01615354, 1.03114280, 1.07240935, 1.13640401, 1.22223233, 1.36263585),
  `31` = c(1.00165606, 1.00467028, 1.01349640, 1.02809356, 1.05378609, 1.11932465, 1.22778183, 1.44749559, 1.78761561),
  `32` = c(1.00396675, 1.00842309, 1.02053528, 1.04143398, 1.07978629, 1.17522977, 1.33959964, 1.67874795, 2.52073977),
  `33` = c(1.00652580, 1.01276269, 1.02808246, 1.05638870, 1.10999073, 1.24246166, 1.47830027, 1.98673091, 3.88781227),
  `34` = c(1.00947609, 1.01759839, 1.03662982, 1.07278573, 1.14487742, 1.32300615, 1.65403182, 2.44030553, 5.25440673),
  `35` = c(1.01264305, 1.02330065, 1.04722060, 1.09154396, 1.18453610, 1.42010537, 1.87769212, 3.11538766, 10.13902433),
  check.names = FALSE
)

# AN (Alpha Regression) - Female
df_an_f <- data.frame(
  Age_Group = ages_vec,
  `22` = c(-3.620585672751, -4.473163624120, -5.187975774717, -5.788460202587, -6.353326378880, -6.800888250845, -7.190286053109, -7.842352703452, -8.500259179252),
  `23` = c(-3.643088387510, -4.438363964558, -5.143516705651, -5.749924540386, -6.297689252681, -6.732736959687, -7.077837424000, -7.725388439894, -8.360074808959),
  `24` = c(-3.632685482494, -4.399876318369, -5.105605285472, -5.715506184677, -6.258140738697, -6.658723948321, -6.967141765630, -7.608913437464, -8.212999212085),
  `25` = c(-3.620668111485, -4.370457441373, -5.065231111788, -5.672385331694, -6.202733887576, -6.555094967982, -6.827225182379, -7.478878250140, -8.083277288386),
  `26` = c(-3.608914710039, -4.348039635079, -5.037991108343, -5.641765210315, -6.143062602578, -6.445830550730, -6.706040264933, -7.348099308036, -8.006335014555),
  `27` = c(-3.598293760586, -4.330839252109, -5.015084209684, -5.599928986092, -6.080588892123, -6.358113407830, -6.631299963100, -7.257499868654, -7.954461961447),
  `28` = c(-3.587288279780, -4.317330137456, -4.996888218259, -5.574707743991, -6.030192797043, -6.269809863819, -6.580937040833, -7.202853285597, -7.915361219068),
  `29` = c(-3.579938908468, -4.304221165084, -4.974344222914, -5.544010451582, -5.974334548628, -6.203949008524, -6.543871331047, -7.167391446044, -7.882935316363),
  `30` = c(-3.572606999078, -4.288242081106, -4.963064285379, -5.521209468665, -5.946823761110, -6.173161655542, -6.516374177194, -7.146010619889, -7.852737222082),
  `31` = c(-3.565172791773, -4.281294683488, -4.954089478901, -5.511127481229, -5.920903679712, -6.157548251405, -6.508016754209, -7.135436872243, -7.820653897187),
  `32` = c(-3.558967784271, -4.277067284664, -4.938463085771, -5.491551826821, -5.896593956785, -6.143022514300, -6.502142658943, -7.132276718886, -7.788380943028),
  `33` = c(-3.554298011377, -4.274709786504, -4.932381249968, -5.473782866778, -5.861344688054, -6.129154060927, -6.498442001473, -7.129157777913, -7.752199253158),
  `34` = c(-3.552444136870, -4.273039592696, -4.926699812038, -5.468952800424, -5.827977162918, -6.115181652977, -6.496664538351, -7.126850488686, -7.706538998405),
  `35` = c(-3.552173761273, -4.271689730263, -4.912996651139, -5.455019502282, -5.797258857897, -6.101725547783, -6.497408672979, -7.127197276322, -7.648259452528),
  check.names = FALSE
)

# BN (Beta Regression) - Female
df_bn_f <- data.frame(
  Age_Group = ages_vec,
  `22` = c(9.825283928, 10.157805869, 11.132385825, 11.989448969, 12.579431747, 12.671986737, 12.343911200, 11.765500425, 9.329595441),
  `23` = c(8.931243920, 10.026458668, 11.038151634, 11.903717005, 12.431542693, 12.431472582, 11.980590782, 11.168959102, 8.367149354),
  `24` = c(8.826103145, 9.923877995, 10.960367070, 11.812484377, 12.264990786, 12.138324835, 11.595196130, 10.543568777, 7.178799863),
  `25` = c(8.737243726, 9.848776977, 10.892987573, 11.703386329, 12.063178198, 11.769278842, 11.141117372, 9.819399505, 5.725737355),
  `26` = c(8.668218581, 9.802021125, 10.804096568, 11.551775755, 11.804860308, 11.361259476, 10.570652710, 8.902349939, 4.345350490),
  `27` = c(8.620515356, 9.759472184, 10.711145038, 11.370962168, 11.509488903, 11.021684379, 10.055510957, 8.042938710, 2.938211829),
  `28` = c(8.590192209, 9.721873635, 10.634586343, 11.199589062, 11.266732448, 10.729554571, 9.592103875, 7.253511096, 1.407946258),
  `29` = c(8.544422629, 9.687483376, 10.597177332, 11.063252584, 11.061739480, 10.435422342, 9.133645610, 6.447972228, -0.303160628),
  `30` = c(8.505289945, 9.668151250, 10.558684235, 10.990040627, 10.931798774, 10.213502560, 8.664130892, 5.585743447, -2.254625392),
  `31` = c(8.475890882, 9.659757906, 10.520924954, 10.906664532, 10.791182088, 9.961352800, 8.265252403, 4.627744681, -4.028189308),
  `32` = c(8.459749556, 9.657234794, 10.486217241, 10.823645717, 10.638420340, 9.683638578, 7.825557727, 3.758151865, -6.070573600),
  `33` = c(8.452716988, 9.650934313, 10.447937682, 10.735173385, 10.478393264, 9.376100763, 7.338980094, 2.775161191, -8.450006638),
  `34` = c(8.455180550, 9.642965238, 10.400465401, 10.638958961, 10.304450567, 9.038214731, 6.796011085, 1.643966040, -11.305782933),
  `35` = c(8.464357511, 9.624060033, 10.334883956, 10.538013922, 10.122168089, 8.668864725, 6.197509774, 0.343203803, -14.776034886),
  check.names = FALSE
)

# --- 2B. MALE COEFFICIENTS ---

# WN (Weighting Factors) - Male
df_wn_m <- data.frame(
  Age_Group = ages_vec,
  `24` = c(0.97224, 0.95454, 0.92614, 0.87252, 0.79946, 0.71439, 0.58411, 0.37907, 0.17421),
  `25` = c(0.97711, 0.95899, 0.93450, 0.88635, 0.82158, 0.74791, 0.62489, 0.42380, 0.21417),
  `26` = c(0.97952, 0.96429, 0.94416, 0.90233, 0.84712, 0.78671, 0.67374, 0.48053, 0.27699),
  `27` = c(0.98249, 0.97042, 0.95542, 0.92080, 0.87667, 0.83180, 0.73302, 0.55317, 0.33091),
  `28` = c(0.98604, 0.97746, 0.96862, 0.94223, 0.91083, 0.88511, 0.80613, 0.63150, 0.35056),
  `29` = c(0.99025, 0.98563, 0.98401, 0.96710, 0.95288, 0.95440, 0.90672, 0.73249, 0.55805),
  `30` = c(0.99582, 0.99621, 1.00412, 0.99866, 1.00620, 1.04869, 1.03960, 0.88684, 0.73054),
  `31` = c(1.00330, 1.01056, 1.02946, 1.03915, 1.07254, 1.15425, 1.19200, 1.09099, 0.92512),
  `32` = c(1.01180, 1.02583, 1.05483, 1.08380, 1.14283, 1.27393, 1.37369, 1.40299, 1.32074),
  `33` = c(1.01684, 1.03585, 1.07462, 1.12972, 1.21919, 1.41563, 1.60596, 1.70859, 2.04726),
  `34` = c(1.02234, 1.04673, 1.09711, 1.16969, 1.28979, 1.55531, 1.89013, 2.09261, 3.04850),
  `35` = c(1.02842, 1.05833, 1.12255, 1.21537, 1.37143, 1.72546, 2.17266, 2.89060, 4.31410),
  `36` = c(1.03555, 1.07220, 1.15129, 1.26774, 1.46825, 1.93125, 2.53647, 3.74263, 6.71221),
  `37` = c(1.04377, 1.08861, 1.18372, 1.32729, 1.58232, 2.18169, 3.05350, 4.92288, 11.25821),
  check.names = FALSE
)

# AN (Alpha Regression) - Male
df_an_m <- data.frame(
  Age_Group = ages_vec,
  `24` = c(-3.57571, -4.52134, -5.17909, -5.64791, -6.00268, -6.21425, -6.59589, -7.41050, -8.37880),
  `25` = c(-3.66577, -4.47307, -5.10885, -5.56096, -5.91500, -6.18067, -6.58235, -7.39244, -8.30632),
  `26` = c(-3.66226, -4.42569, -5.03862, -5.48720, -5.85483, -6.15850, -6.57982, -7.38156, -8.23866),
  `27` = c(-3.65242, -4.38231, -4.98663, -5.42736, -5.79723, -6.14672, -6.58647, -7.37716, -8.17914),
  `28` = c(-3.63851, -4.33919, -4.93596, -5.38038, -5.75302, -6.14425, -6.60077, -7.37895, -8.12722),
  `29` = c(-3.62267, -4.30868, -4.90358, -5.33552, -5.71303, -6.15279, -6.62625, -7.39066, -8.08775),
  `30` = c(-3.60323, -4.28625, -4.86546, -5.31387, -5.71681, -6.17357, -6.66583, -7.40552, -8.04428),
  `31` = c(-3.58949, -4.26702, -4.84616, -5.28691, -5.72904, -6.19579, -6.70263, -7.41260, -7.99268),
  `32` = c(-3.57932, -4.25241, -4.83066, -5.27527, -5.74295, -6.21899, -6.73480, -7.41311, -7.93458),
  `33` = c(-3.56641, -4.24051, -4.81306, -5.25719, -5.75842, -6.24378, -6.76407, -7.40619, -7.86918),
  `34` = c(-3.55736, -4.23132, -4.79950, -5.25977, -5.76956, -6.26329, -6.79050, -7.39062, -7.79562),
  `35` = c(-3.54954, -4.22430, -4.78270, -5.26631, -5.78414, -6.28486, -6.80668, -7.36198, -7.71927),
  `36` = c(-3.54408, -4.20938, -4.77607, -5.27659, -5.80156, -6.30759, -6.81915, -7.32794, -7.63778),
  `37` = c(-3.53720, -4.20328, -4.76603, -5.29008, -5.82141, -6.33057, -6.82659, -7.28647, -7.54950),
  check.names = FALSE
)

# BN (Beta Regression) - Male
df_bn_m <- data.frame(
  Age_Group = ages_vec,
  `24` = c(10.38368, 10.32870, 10.85270, 11.22832, 11.39958, 11.19478, 10.39475, 8.75753, 5.05343),
  `25` = c(9.34315, 10.08267, 10.66914, 11.06395, 11.24541, 10.96618, 10.05895, 8.13462, 3.95521),
  `26` = c(9.14679, 9.87694, 10.52267, 10.92299, 11.09156, 10.72851, 9.69400, 7.45264, 2.76380),
  `27` = c(8.96314, 9.71268, 10.39798, 10.80233, 10.94647, 10.47691, 9.29222, 6.70826, 1.46602),
  `28` = c(8.79967, 9.58896, 10.29868, 10.69461, 10.79733, 10.20517, 8.84648, 5.89779, 0.05308),
  `29` = c(8.66016, 9.49291, 10.21109, 10.59935, 10.634586343, 9.88113, 8.30767, 4.92715, -1.57905),
  `30` = c(8.55249, 9.42837, 10.14267, 10.49478, 10.42370, 9.48406, 7.64870, 3.84990, -3.30542),
  `31` = c(8.47809, 9.39058, 10.07501, 10.38314, 10.17416, 9.08523, 6.97291, 2.76960, -5.08823),
  `32` = c(8.42316, 9.35647, 10.00828, 10.25913, 9.92946, 8.67975, 6.29232, 1.64114, -6.99003),
  `33` = c(8.35664, 9.30531, 9.94785, 10.14251, 9.68293, 8.24999, 5.57633, 0.43990, -9.05261),
  `34` = c(8.29938, 9.26205, 9.88984, 10.03293, 9.47540, 7.86724, 4.81144, -0.84014, -11.31141),
  `35` = c(8.25495, 9.22445, 9.83740, 9.91563, 9.24963, 7.44295, 4.09252, -2.08242, -13.45992),
  `36` = c(8.22376, 9.19848, 9.78011, 9.78793, 9.00203, 6.97202, 3.30274, -3.42110, -15.82677),
  `37` = c(8.20194, 9.17425, 9.72529, 9.64887, 8.72757, 6.44414, 2.42909, -4.88077, -18.49036),
  check.names = FALSE
)

# Consolidated Luy List
coef_luy <- list(
  Female = list(
    wn = df_wn_f,
    an = df_an_f,
    bn = df_bn_f
  ),
  Male = list(
    wn = df_wn_m,
    an = df_an_m,
    bn = df_bn_m
  )
)

# ==============================================================================
# 3. BRASS/HILL COEFFICIENTS
# ==============================================================================
# 1. FEMALES (Table 86)
brass_female <- data.frame(
  Age_Group = c(10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60),
  `22` = c(0.420, 0.418, 0.404, 0.366, 0.303, 0.241, 0.125, 0.007, -0.190, -0.368, -0.466),
  `23` = c(0.470, 0.489, 0.500, 0.485, 0.445, 0.401, 0.299, 0.186, -0.017, -0.220, -0.352),
  `24` = c(0.517, 0.556, 0.590, 0.598, 0.580, 0.554, 0.467, 0.361, 0.158, -0.059, -0.217),
  `25` = c(0.557, 0.618, 0.673, 0.704, 0.708, 0.701, 0.630, 0.535, 0.334, 0.101, -0.084),
  `26` = c(0.596, 0.678, 0.756, 0.809, 0.834, 0.844, 0.791, 0.708, 0.514, 0.270, 0.053),
  `27` = c(0.634, 0.738, 0.838, 0.913, 0.957, 0.986, 0.950, 0.884, 0.699, 0.456, 0.220),
  `28` = c(0.674, 0.800, 0.921, 1.016, 1.080, 1.128, 1.111, 1.063, 0.890, 0.645, 0.378),
  `29` = c(0.717, 0.863, 1.004, 1.118, 1.203, 1.270, 1.274, 1.250, 1.095, 0.856, 0.579),
  `30` = c(0.758, 0.924, 1.085, 1.218, 1.323, 1.412, 1.442, 1.447, 1.318, 1.083, 0.800),
  check.names = FALSE
)

# 2. MALES A (Base 32.5)
brass_male_a <- data.frame(
  Age_Group = c(10, 15, 20, 25, 30, 35, 40, 45, 50, 55),
  `28` = c(0.192, 0.151, 0.043, -0.093, -0.327, -0.640, -0.856, -1.120, -1.162, -1.040),
  `29` = c(0.258, 0.243, 0.166, 0.051, -0.161, -0.408, -0.714, -0.963, -1.030, -0.943),
  `30` = c(0.322, 0.336, 0.287, 0.194, 0.001, -0.211, -0.554, -0.806, -0.903, -0.850),
  `31` = c(0.388, 0.429, 0.406, 0.335, 0.162, -0.047, -0.379, -0.651, -0.776, -0.758),
  `32` = c(0.455, 0.522, 0.523, 0.474, 0.319, 0.109, -0.203, -0.495, -0.651, -0.667),
  `33` = c(0.521, 0.613, 0.638, 0.611, 0.475, 0.269, -0.034, -0.340, -0.524, -0.576),
  `34` = c(0.587, 0.702, 0.750, 0.744, 0.627, 0.438, 0.133, -0.183, -0.396, -0.486),
  `35` = c(0.650, 0.790, 0.861, 0.877, 0.779, 0.610, 0.303, -0.024, -0.264, -0.397),
  check.names = FALSE
)

# 3. MALES B (Base 37.5)
brass_male_b <- data.frame(
  Age_Group = c(10, 15, 20, 25, 30, 35, 40, 45, 50, 55),
  `36` = c(0.384, 0.378, 0.324, 0.164, -0.043, -0.359, -0.624, -0.757, -0.742, -0.559),
  `37` = c(0.460, 0.484, 0.455, 0.315, 0.122, -0.183, -0.473, -0.631, -0.650, -0.541),
  `38` = c(0.537, 0.588, 0.582, 0.465, 0.286, -0.015, -0.316, -0.503, -0.559, -0.485),
  `39` = c(0.613, 0.690, 0.708, 0.613, 0.450, 0.152, -0.157, -0.372, -0.471, -0.425),
  `40` = c(0.687, 0.790, 0.833, 0.759, 0.614, 0.321, 0.003, -0.237, -0.377, -0.366),
  `41` = c(0.758, 0.888, 0.954, 0.904, 0.778, 0.496, 0.168, -0.099, -0.280, -0.308),
  `42` = c(0.827, 0.984, 1.075, 1.051, 0.944, 0.677, 0.342, 0.047, -0.182, -0.238),
  `43` = c(0.897, 1.079, 1.195, 1.197, 1.116, 0.863, 0.529, 0.208, -0.069, -0.149),
  `44` = c(0.969, 1.174, 1.318, 1.346, 1.295, 1.062, 0.722, 0.393, 0.063, -0.049),
  check.names = FALSE
)

# Combinar na lista final
coef_brass_hill <- list(
  Female = brass_female,
  Male_A = brass_male_a,
  Male_B = brass_male_b
)

# ------------------------------------------------------------------------------
# 4. BRASS Z VALUES (Table 88 - Manual X)
# Standard Values for Calculation of Reference Period t(n)
# Source: UN Manual X, Annex IV, Table 88
# ------------------------------------------------------------------------------
coef_z_brass <- data.frame(
  Age = 26:75,
  Z = c(
    0.090, 0.090, 0.090, 0.090, 0.090,
    0.090, 0.090, 0.090, 0.090, 0.091,
    0.092, 0.093, 0.095, 0.099, 0.104,
    0.109, 0.115, 0.122, 0.130, 0.139,
    0.149, 0.160, 0.171, 0.182, 0.193,
    0.205, 0.218, 0.231, 0.245, 0.259,
    0.274, 0.289, 0.305, 0.321, 0.338,
    0.356, 0.374, 0.392, 0.411, 0.431,
    0.452, 0.473, 0.495, 0.518, 0.542,
    0.568, 0.595, 0.622, 0.650, 0.678
  )
)

# Combine W lists
coef_brass_hill <- list(
  Female = brass_female,
  Male_A = brass_male_a,
  Male_B = brass_male_b
)

# ==============================================================================
# 5. MODEL LIFE TABLES (UN/CD)
# ==============================================================================
# Checks for the existence of the raw .rds file and processes it.
mlt_path <- "data-raw/MLT_UN2011_130_1y_complete.rds"

if (file.exists(mlt_path)) {
  raw_mlt <- readRDS(mlt_path)
  mlt_un_data <- as.data.frame(raw_mlt)

  # Column standardization
  names(mlt_un_data)[names(mlt_un_data) == "age"] <- "Age"

  if ("lx1" %in% names(mlt_un_data)) {
    mlt_un_data$lx <- mlt_un_data$lx1
  } else if (!"lx" %in% names(mlt_un_data)) {
    stop("The .rds file must contain an 'lx' or 'lx1' column.")
  }

  # Base 1 normalization
  if (max(mlt_un_data$lx, na.rm = TRUE) > 10) {
    mlt_un_data$lx <- mlt_un_data$lx / 100000
  }

  message("Model Life Tables loaded and standardized.")
} else {
  warning("Model Life Table .rds file not found in data-raw/.")
  mlt_un_data <- NULL
}

# ==============================================================================
# 6. SAVE INTERNAL DATA
# ==============================================================================
usethis::use_data(
  coef_timaeus,
  coef_luy,
  coef_brass_hill,
  coef_z_brass,
  mlt_un_data,
  internal = TRUE,
  overwrite = TRUE,
  compress = "xz"
)
